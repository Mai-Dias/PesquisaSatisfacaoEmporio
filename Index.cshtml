@page
@model PesquisaSatisfacaoEmporio.Pages.IndexModel
@{
    ViewData["Title"] = "Pesquisa de Satisfação";
}

<div class="card-form">
    <form id="surveyForm" method="post">
        <!-- Etapa 1: Avaliação -->
        <div class="step" @(Model.Step != 1 ? "style='display:none;'" : "") id="step-1">
            <h2>Sua experiência</h2>
            <p>Como você avalia sua experiência?</p>
            <input type="number" name="Rating" min="1" max="10" value="@Model.Rating" required class="form-control" />
            <div class="buttons">
                <button type="button" class="btn" onclick="nextStep()">Avançar</button>
            </div>
        </div>
        <!-- Etapa 2: Comentário -->
        <div class="step" @(Model.Step != 2 ? "style='display:none;'" : "") id="step-2">
            <h2>Comentário</h2>
            <p>Deixe seu comentário (opcional):</p>
            <textarea name="Comment" class="form-control">@Model.Comment</textarea>
            <div class="buttons">
                <button type="button" class="btn btn-secondary" onclick="prevStep()">Voltar</button>
                <button type="button" class="btn" onclick="nextStep()">Avançar</button>
            </div>
        </div>
        <!-- Etapa 3: Consentimento LGPD -->
        <div class="step" @(Model.Step != 3 ? "style='display:none;'" : "") id="step-3">
            <h2>Consentimento</h2>
            <label style="display: flex; align-items: center;">
                <input type="checkbox" name="Consent" required @(Model.Consent ? "checked" : "") style="margin-right: 8px;" />
                Concordo com os termos da LGPD
            </label>
            <div class="buttons">
                <button type="button" class="btn btn-secondary" onclick="prevStep()">Voltar</button>
                <button type="button" class="btn" onclick="nextStep()">Avançar</button>
            </div>
        </div>
        <!-- Etapa 4: CPF -->
        <div class="step" @(Model.Step != 4 ? "style='display:none;'" : "") id="step-4">
            <h2>Clube de Fidelidade</h2>
            <p>Informe seu CPF para resgatar seu benefício no Clube de Fidelidade Empório Quatro Estrelas.</p>
            <input type="text" id="cpf" name="CPF" maxlength="14" required value="@Model.CPF" class="form-control" placeholder="000.000.000-00" />
            <div class="buttons">
                <button type="button" class="btn btn-secondary" onclick="prevStep()">Voltar</button>
                <button type="submit" class="btn">Finalizar e Resgatar</button>
            </div>
            <small id="cpf-erro" style="color: #c95214; display: none;">CPF inválido!</small>
        </div>
        <!-- Mensagem final -->
        @if (Model.Step == 5)
        {
            <div class="step" id="step-5" style="display:block;">
                <h2>Obrigado!</h2>
                <p>@Model.FinalMessage</p>
            </div>
        }
        <input type="hidden" id="currentStep" name="Step" value="@Model.Step" />
    </form>
</div>

@section Scripts{
<script>
    let currentStep = parseInt(document.getElementById('currentStep').value) || 1;

    function showStep(step) {
        for (let i = 1; i <= 5; i++) {
            let el = document.getElementById('step-' + i);
            if (el) el.style.display = (i === step) ? '' : 'none';
        }
        document.getElementById('currentStep').value = step;
        currentStep = step;
    }
    function nextStep() {
        if (currentStep < 4) {
            showStep(currentStep + 1);
        }
    }
    function prevStep() {
        if (currentStep > 1) {
            showStep(currentStep - 1);
        }
    }
    document.addEventListener('DOMContentLoaded', function () {
        showStep(currentStep);
        // Máscara de CPF
        var cpfInput = document.getElementById('cpf');
        if (cpfInput) {
            cpfInput.addEventListener('input', function () {
                let value = cpfInput.value.replace(/\D/g, '').substring(0, 11);
                let formatted = value;
                if (value.length > 9)
                    formatted = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
                else if (value.length > 6)
                    formatted = value.replace(/(\d{3})(\d{3})(\d{1,3})/, "$1.$2.$3");
                else if (value.length > 3)
                    formatted = value.replace(/(\d{3})(\d{1,3})/, "$1.$2");
                cpfInput.value = formatted;
            });
        }
    });
</script>
}
<style>
    .card-form { max-width: 400px; margin: 40px auto; padding: 24px; border-radius: 20px; background: #fff; box-shadow: 0 2px 8px #0002;}
    .step { margin-bottom: 24px; }
    .form-control { width: 100%; padding: 8px; margin: 10px 0 0 0; border-radius: 8px; border: 1px solid #ddd; }
    h2 { color: #c95214; margin-bottom: 10px; }
    .btn { background: #c95214; color: #fff; border: none; border-radius: 8px; padding: 8px 22px; margin-top: 16px; margin-right: 4px; cursor: pointer; font-size: 16px; }
    .btn-secondary { background: #eee; color: #333; }
    .buttons { margin-top: 18px; }
</style>
